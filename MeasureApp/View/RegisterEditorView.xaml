<UserControl x:Class="MeasureApp.View.RegisterEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MeasureApp.View"
             xmlns:vm="clr-namespace:MeasureApp.ViewModel"
             xmlns:v="clr-namespace:MeasureApp.View"
             xmlns:c="clr-namespace:MeasureApp.View.Converter"
             xmlns:control="clr-namespace:MeasureApp.View.Control"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:hc="https://handyorg.github.io/handycontrol"
             xmlns:ScottPlot="clr-namespace:ScottPlot.WPF;assembly=ScottPlot.WPF"
             xmlns:behaviors="clr-namespace:MeasureApp.Behaviors"
             xmlns:ikriv="clr-namespace:IKriv.Windows.Controls.Behaviors"
             DataContext="{Binding Source={StaticResource Locator},Path=RegisterEditor}"
             d:DataContext="{d:DesignInstance vm:DesignRegisterEditorVM, IsDesignTimeCreatable=True}"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <UserControl.Resources>
    </UserControl.Resources>
    <Grid>
        <Grid Margin="5">
            <Grid.Resources>
                <SolidColorBrush x:Key="PrimaryBrush" Color="Orange"/>
            </Grid.Resources>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <hc:SimpleStackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                <Button Content="导入寄存器表" Margin="10,0" Command="{Binding ImportRegisterMapCommand}"/>
                <TextBlock Text="通信设备" Margin="10,0" VerticalAlignment="Center"/>
                <ComboBox ItemsSource="{Binding Context.Devices.Info}" SelectedItem="{Binding SelectedDevice}" DisplayMemberPath="Name" Margin="5,0" MinWidth="200"/>
            </hc:SimpleStackPanel>
            <hc:TabControl Grid.Row="1" ItemsSource="{Binding RegFiles}" Margin="0,10,0,0" Style="{StaticResource TabControlCapsule}" ikriv:TabContent.IsCached="True">
                <hc:TabControl.ItemTemplate>
                    <DataTemplate>
                        <hc:SimpleStackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Name}" Padding="5" FontFamily="Consolas" FontSize="16" FontStyle="Italic" FontWeight="Bold"/>
                            <Button Content="R" Command="{Binding DataContext.ReadRouterCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Style="{StaticResource ButtonDashedInfo.Small}" Margin="5,0"/>
                        </hc:SimpleStackPanel>
                    </DataTemplate>
                </hc:TabControl.ItemTemplate>
                <ikriv:TabContent.Template>
                    <DataTemplate>
                        <Grid>
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding Registers}" ScrollViewer.VerticalScrollBarVisibility="Auto">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <GroupBox Margin="10" Style="{StaticResource GroupBoxOriginal}">
                                                <GroupBox.Header>
                                                    <hc:SimpleStackPanel Orientation="Horizontal">
                                                        <TextBlock Text="{Binding Name}" FontFamily="Consolas" FontWeight="Bold" FontSize="14" Foreground="DarkSlateGray" VerticalAlignment="Center"/>
                                                        <TextBlock Margin="10,0" Foreground="LightSlateGray" VerticalAlignment="Center">
                                                        <Run Text="{Binding Address, StringFormat='0x{0:X4}'}"/>
                                                        <Run Text=":"/>
                                                        <Run Text="{Binding BitWidth}"/><Run Text="b"/>
                                                        </TextBlock>
                                                        <!--<hc:TextBox Grid.Column="2" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}" hc:InfoElement.Placeholder="DEC" VerticalContentAlignment="Center" Margin="5,0" Width="100"/>-->
                                                        <control:NumericTextBox Grid.Column="2" Value="{Binding Value, UpdateSourceTrigger=PropertyChanged}" VerticalContentAlignment="Center" Margin="5,0" Width="100"/>
                                                        <Button Content="R" Command="{Binding DataContext.ReadRouterCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Style="{StaticResource ButtonDashedInfo.Small}" Margin="5,0"/>
                                                        <Button Content="W" Command="{Binding DataContext.WriteRouterCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Style="{StaticResource ButtonDashedInfo.Small}" Margin="5,0"/>
                                                    </hc:SimpleStackPanel>
                                                </GroupBox.Header>
                                                <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="3" Margin="0,5,0,0">
                                                    <ItemsControl ItemsSource="{Binding BitFields}" ScrollViewer.CanContentScroll="False">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0.5">
                                                                    <Grid MinHeight="32">
                                                                        <Grid.ColumnDefinitions>
                                                                            <ColumnDefinition Width="1*"/>
                                                                            <ColumnDefinition Width="1.5*"/>
                                                                            <ColumnDefinition Width="1.5*"/>
                                                                            <ColumnDefinition Width="Auto"/>
                                                                            <ColumnDefinition Width="3*"/>
                                                                        </Grid.ColumnDefinitions>
                                                                        <TextBlock Grid.Column="0" HorizontalAlignment="Center" VerticalAlignment="Center">
                                                                    <Run Text="["/>
                                                                    <Run Text="{Binding EndBit}"/>
                                                                    <Run Text=":"/>
                                                                    <Run Text="{Binding StartBit}"/>
                                                                    <Run Text="]"/>
                                                                        </TextBlock>
                                                                        <TextBlock Grid.Column="1" Text="{Binding Name}" FontFamily="Consolas" TextWrapping="Wrap" VerticalAlignment="Center" Margin="8,0"/>
                                                                        <!--<hc:TextBox Grid.Column="2" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}" hc:InfoElement.Placeholder="DEC" VerticalContentAlignment="Center" Margin="5,2"/>-->
                                                                        <control:NumericTextBox Grid.Column="2" Value="{Binding Value, UpdateSourceTrigger=PropertyChanged}" VerticalContentAlignment="Center" Margin="5,2"/>
                                                                        <hc:SimpleStackPanel Grid.Column="3" Orientation="Horizontal">
                                                                            <Button Content="R" Command="{Binding DataContext.ReadRouterCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Style="{StaticResource ButtonDashedInfo.Small}" Margin="5,0"/>
                                                                            <Button Content="W" Command="{Binding DataContext.WriteRouterCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Style="{StaticResource ButtonDashedInfo.Small}" Margin="5,0"/>
                                                                        </hc:SimpleStackPanel>
                                                                        <TextBlock Grid.Column="4" Text="{Binding Desc}" FontFamily="Microsoft YaHei UI" TextWrapping="WrapWithOverflow" VerticalAlignment="Center" Padding="8,2"/>
                                                                    </Grid>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </Border>
                                            </GroupBox>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </DataTemplate>
                </ikriv:TabContent.Template>
            </hc:TabControl>
        </Grid>
    </Grid>
</UserControl>
